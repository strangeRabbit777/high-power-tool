var kutty=kutty||function(){"use strict";var t=["get","post","put","delete","patch"];function y(t){if(t==="null"||t==="false"||t===""){return null}else if(t.lastIndexOf("ms")===t.length-2){return parseFloat(t.substr(0,t.length-2))}else if(t.lastIndexOf("s")===t.length-1){return parseFloat(t.substr(0,t.length-1))*1e3}else{return parseFloat(t)}}function u(t,e){return t.getAttribute&&t.getAttribute(e)}function o(t,e){return u(t,e)||u(t,"data-"+e)}function a(t){return t.parentElement}function s(){return document}function l(t,e){if(e(t)){return t}else if(a(t)){return l(a(t),e)}else{return null}}function g(t,e){var r=null;l(t,function(t){return r=u(t,e)});return r}function f(t,e){return t!=null&&(t.matches||t.matchesSelector||t.msMatchesSelector||t.mozMatchesSelector||t.webkitMatchesSelector||t.oMatchesSelector).call(t,e)}function c(t,e){do{if(t==null||f(t,e))return t}while(t=t&&a(t))}function v(t){var e=new DOMParser;var r=e.parseFromString(t,"text/html");return r.body}function e(t,e){return Object.prototype.toString.call(t)==="[object "+e+"]"}function d(t){return e(t,"Function")}function h(t){return e(t,"Object")}function p(t){var e="kutty-internal-data";var r=t[e];if(!r){r=t[e]={}}return r}function m(t,e){if(t){for(var r=0;r<t.length;r++){e(t[r])}}}function r(t){var e=t.getBoundingClientRect();var r=e.top;var n=e.bottom;return r<window.innerHeight&&n>=0}function k(t){return s().body.contains(t)}function b(t,e){return t.concat(e)}function S(t){return t.split(/\s+/)}function w(t){var e=l(t,function(t){return u(t,"kt-target")!==null});if(e){var r=u(e,"kt-target");if(r==="this"){return e}else{return s().querySelector(r)}}else{var n=p(t);if(n.boosted){return s().body}else{return t}}}function E(e,r){m(e.attributes,function(t){if(!r.hasAttribute(t.name)){e.removeAttribute(t.name)}});m(r.attributes,function(t){e.setAttribute(t.name,t.value)})}function O(t){var n=[];m(t.children,function(t){if(o(t,"kt-swap-oob")==="true"){var e=s().getElementById(t.id);if(e){var r=s().createDocumentFragment();r.appendChild(t);n=n.concat(T(e,r))}else{t.parentNode.removeChild(t);$(s().body,"oobErrorNoTarget.kutty",{id:t.id,content:t})}}});return n}function L(n,t){var i=[];m(t.querySelectorAll("[id]"),function(t){var e=n.querySelector(t.tagName+"[id="+t.id+"]");if(e){var r=t.cloneNode();E(t,e);i.push(function(){E(t,r)})}});return i}function i(t,e,r){var n=L(t,r);while(r.childNodes.length>0){var i=r.firstChild;t.insertBefore(i,e);if(i.nodeType!==Node.TEXT_NODE){$(i,"load.kutty",{elt:i,parent:a(i)});Y(i)}}return n}function T(t,e){if(t.tagName==="BODY"){return N(t,e)}else{var r=i(a(t),t,e);a(t).removeChild(t);return r}}function C(t,e){return i(t,t.firstChild,e)}function x(t,e){return i(a(t),t,e)}function q(t,e){return i(t,null,e)}function A(t,e){return i(a(t),t.nextSibling,e)}function N(t,e){var r=t.firstChild;var n=i(t,r,e);if(r){while(r.nextSibling){t.removeChild(r.nextSibling)}t.removeChild(r)}return n}function I(t,e){var r=g(t,"kt-select");if(r){var n=s().createDocumentFragment();m(e.querySelectorAll(r),function(t){n.appendChild(t)});e=n}return e}function M(t,e,r,n){var i=v(n);if(i){var a=O(i);i=I(r,i);switch(t){case"outerHTML":return b(a,T(e,i));case"afterbegin":return b(a,C(e,i));case"beforebegin":return b(a,x(e,i));case"beforeend":return b(a,q(e,i));case"afterend":return b(a,A(e,i));default:return b(a,N(e,i))}}}function R(t,e){if(e){if(e.indexOf("{")===0){var r=JSON.parse(e);for(var n in r){if(r.hasOwnProperty(n)){var i=r[n];if(!h(i)){i={value:i}}$(t,n,i)}}}else{$(t,e,[])}}}function D(t){var e={trigger:"click"};var r=g(t,"kt-trigger");if(r){var n=S(r);if(n.length>0){var i=n[0];if(i==="every"){e.pollInterval=y(n[1])}else if(i.indexOf("sse:")===0){e.sseEvent=i.substr(4)}else{e["trigger"]=i;for(var a=1;a<n.length;a++){var o=n[a].trim();if(o==="changed"){e.changed=true}if(o==="once"){e.once=true}if(o.indexOf("delay:")===0){e.delay=y(o.substr(6))}}}}}else{if(f(t,"form")){e["trigger"]="submit"}else if(f(t,"input, textarea, select")){e["trigger"]="change"}}return e}function F(t){var e=S(t);if(e.length>1){var r=e[0];var n=e[1].trim();var i;var a;if(n.indexOf(":")>0){var o=n.split(":");i=o[0];a=y(o[1])}else{i=n;a=100}return{operation:r,cssClass:i,delay:a}}else{return null}}function H(i,t,e){m(t.split("&"),function(t){var n=0;m(t.split(","),function(t){var e=t.trim();var r=F(e);if(r){if(r.operation==="toggle"){setTimeout(function(){setInterval(function(){i.classList[r.operation].call(i.classList,r.cssClass)},r.delay)},n);n=n+r.delay}else{n=n+r.delay;setTimeout(function(){i.classList[r.operation].call(i.classList,r.cssClass)},n)}}})})}function P(t,e,r,n){var i=p(t);i.timeout=setTimeout(function(){if(k(t)){St(t,e,r);P(t,e,o(t,"kt-"+e),n)}},n)}function X(t){return location.hostname===t.hostname&&u(t,"href")&&!u(t,"href").startsWith("#")}function U(t,e,r){if(t.tagName==="A"&&X(t)||t.tagName==="FORM"){e.boosted=true;var n,i;if(t.tagName==="A"){n="get";i=u(t,"href")}else{var a=u(t,"method");n=a?a.toLowerCase():"get";i=u(t,"action")}B(t,n,i,e,r,true)}}function j(t){return t.tagName==="FORM"||f(t,'input[type="submit"], button')&&c(t,"form")!==null||t.tagName==="A"&&t.href&&t.href.indexOf("#")!==0}function B(i,a,o,t,u,s){var e=function(t){if(s||j(i))t.preventDefault();var e=p(t);var r=p(i);if(!e.handled){e.handled=true;if(u.once){if(r.triggeredOnce){return}else{r.triggeredOnce=true}}if(u.changed){if(r.lastValue===i.value){return}else{r.lastValue=i.value}}if(r.delayed){clearTimeout(r.delayed)}var n=function(){St(i,a,o,t.target)};if(u.delay){r.delayed=setTimeout(n,y(u.delay))}else{n()}}};t.trigger=u.trigger;t.eventListener=e;i.addEventListener(u.trigger,e)}function J(){if(!window["kuttyScrollHandler"]){var t=function(){m(s().querySelectorAll("[kt-trigger='reveal']"),function(t){z(t)})};window["kuttyScrollHandler"]=t;window.addEventListener("scroll",t)}}function z(t){var e=p(t);if(!e.revealed&&r(t)){e.revealed=true;St(t,e.verb,e.path)}}function K(t){if(!k(t)){t.sseSource.close();return true}}function V(e,t){var r={initializer:function(){new EventSource(t,r.config)},config:{withCredentials:true}};$(e,"initSSE.kutty",{config:r});var n=r.initializer();n.onerror=function(t){$(e,"sseError.kutty",{error:t,source:n});K(e)};p(e).sseSource=n}function G(t,e,r,n){var i=l(e,function(t){return t.sseSource});if(i){var a=function(){if(!K(i)){if(k(e)){St(e,r,n)}else{i.sseSource.removeEventListener(t,a)}}};i.sseSource.addEventListener(t,a)}else{$(e,"noSSESourceError.kutty")}}function _(t,e,r,n){if(!t.loaded){t.loaded=true;St(e,r,n)}}function W(r,n,i){var a=false;m(t,function(t){var e=o(r,"kt-"+t);if(e){a=true;n.path=e;n.verb=t;if(i.sseEvent){G(i.sseEvent,r,t,e)}else if(i.trigger==="revealed"){J();z(r)}else if(i.trigger==="load"){_(n,r,t,e)}else if(i.pollInterval){n.polling=true;P(r,t,e,i.pollInterval)}else{B(r,t,e,n,i)}}});return a}function Y(t){var e=p(t);if(!e.processed){e.processed=true;var r=D(t);var n=W(t,e,r);if(!n&&g(t,"kt-boost")==="true"){U(t,e,r)}var i=o(t,"kt-sse-source");if(i){V(t,i)}var a=o(t,"kt-classes");if(a){H(t,a)}}if(t.children){m(t.children,function(t){Y(t)})}}function Q(t,e,r){var n=g(t,"kt-error-url");if(n){var i=new XMLHttpRequest;i.open("POST",n);i.setRequestHeader("Content-Type","application/json;charset=UTF-8");i.send(JSON.stringify({elt:t.id,event:e,detail:r}))}}function Z(t,e){var r;if(window.CustomEvent&&typeof window.CustomEvent==="function"){r=new CustomEvent(t,{bubbles:true,cancelable:true,detail:e})}else{r=s().createEvent("CustomEvent");r.initCustomEvent(t,true,true,e)}return r}function $(t,e,r){r["elt"]=t;var n=Z(e,r);if(kutty.logger){kutty.logger(t,e,r);if(e.indexOf("Error")>0){Q(t,e,r)}}var i=t.dispatchEvent(n);var a=t.dispatchEvent(Z("all.kutty",{elt:t,originalDetail:r,originalEvent:n}));return i&&a}function n(t,e,r){var n,i,a;if(d(t)){wt(function(){n=s().body;i="all.kutty";a=t;n.addEventListener(i,a)})}else if(d(e)){wt(function(){n=s().body;i=t;a=e;n.addEventListener(i,a)})}else{n=t;i=e;a=r;n.addEventListener(i,a)}}function tt(){var t=s().querySelector(".kutty-history-elt");return t||s().body}function et(t,r){t=t.sort(function(t,e){return r[e]-r[t]});var e=0;m(t,function(t){e++;if(e>20){delete r[t];localStorage.removeItem(t)}})}function rt(t){var e=JSON.parse(localStorage.getItem("kt-history-timestamps"))||{};e[t]=Date.now();var r=Object.keys(e);if(r.length>20){et(r,e)}localStorage.setItem("kt-history-timestamps",JSON.stringify(e))}function nt(){var t=tt();var e=location.pathname+location.search;$(s().body,"historyUpdate.kutty",{path:e,historyElement:t});history.replaceState({},s().title,window.location.href);localStorage.setItem("kt-history:"+e,t.innerHTML);rt(e)}function it(t){history.pushState({},"",t)}function at(t){m(t,function(t){t.call()})}function ot(e){$(s().body,"historyCacheMiss.kutty",{path:e});var t=new XMLHttpRequest;t.open("GET",e,true);t.onload=function(){$(s().body,"historyCacheMissLoad.kutty",{path:e});if(this.status>=200&&this.status<400){var t=v(this.response);t=t.querySelector(".kutty-history-elt")||t;at(N(tt(),t))}}}function ut(){var t=location.pathname+location.search;$(s().body,"historyRestore.kutty",{path:t});var e=localStorage.getItem("kt-history:"+t);if(e){rt(t);at(N(tt(),v(e)))}else{ot(t)}}function st(t){return g(t,"kt-push-url")==="true"||t.tagName==="A"&&p(t).boosted}function lt(t){ct(t,"add")}function ft(t){ct(t,"remove")}function ct(t,e){var r=g(t,"kt-indicator");if(r){var n=s().querySelectorAll(r)}else{n=[t]}m(n,function(t){t.classList[e].call(t.classList,"kutty-request")})}function vt(t,e){for(var r=0;r<t.length;r++){var n=t[r];if(n.isSameNode(e)){return true}}return false}function dt(e,r,t){if(t==null||vt(e,t)){return}else{e.push(t)}var n=u(t,"name");var i=t.value;if(n&&i){var a=r[n];if(a){if(Array.isArray(a)){a.push(i)}else{r[n]=[a,i]}}else{r[n]=i}}if(f(t,"form")){var o=t.elements;m(o,function(t){dt(e,r,t)})}}function yt(t){var e=[];var r={};dt(e,r,t);var n=o(t,"kt-include");if(n){var i=s().querySelectorAll(n);m(i,function(t){dt(e,r,t)})}dt(e,r,c(t,"form"));return r}function gt(t,e,r){if(t!==""){t+="&"}t+=encodeURIComponent(e)+"="+encodeURIComponent(r);return t}function ht(t){var e="";for(var r in t){if(t.hasOwnProperty(r)){var n=t[r];if(Array.isArray(n)){m(n,function(t){e=gt(e,r,t)})}else{e=gt(e,r,n)}}}return e}function pt(t,e,r,n){t.setRequestHeader((n?"":"X-KT-")+e,r||"")}function mt(t,e,r,n,i){pt(t,"Request","true");pt(t,"Trigger-Id",u(e,"id"));pt(t,"Trigger-Name",u(e,"name"));pt(t,"Target-Id",u(r,"id"));pt(t,"Current-URL",s().location.href);if(n){pt(t,"Prompt",n)}if(i){pt(t,"Event-Target",u(i,"id"))}if(s().activeElement){pt(t,"Active-Element",u(s().activeElement,"id"));if(s().activeElement.value){pt(t,"Active-Element-Value",s().activeElement.value)}}}function kt(e,t,r){var n=g(t,"kt-params");if(n){if(n==="none"){return{}}else if(n==="*"){return e}else if(n.indexOf("not ")===0){m(n.substr(4).split(","),function(t){t=t.trim();delete e[t]});return e}else{var i={};m(n.split(","),function(t){i[t]=e[t]});return i}}else{if(r==="get"){return{}}else{return e}}}function bt(t){var e=g(t,"kt-swap");var r={swapStyle:"innerHTML",swapDelay:0,settleDelay:100};if(e){var n=S(e);if(n.length>0){r["swapStyle"]=n[0];for(var i=1;i<r.length;i++){var a=r[i];if(a.indexOf("swap:")===0){r["swapDelay"]=y(a.substr(5))}if(a.indexOf("settle:")===0){r["settleDelay"]=y(a.substr(7))}}}}return r}function St(o,t,e,r){var n=p(o);if(n.requestInFlight){return}else{n.requestInFlight=true}var u=function(){n.requestInFlight=false};var s=w(o);var i=g(o,"kt-prompt");if(i){var a=a(i);if(!$(o,"prompt.kutty",{prompt:a,target:s}))return u()}var l=g(o,"kt-confirm");if(l){if(!confirm(l))return u()}var f=new XMLHttpRequest;var c=yt(o,t);c=kt(c,o,t);if(!$(o,"values.kutty",{values:c,target:s}))return u();var v;if(t==="get"){var d=Object.keys(c).length===0;f.open("GET",e+(d?"":"?"+ht(c)),true)}else{v=e;f.open("POST",v,true);pt(f,"Content-Type","application/x-www-form-urlencoded; charset=UTF-8",true);if(t!=="post"){pt(f,"X-HTTP-Method-Override",t.toUpperCase(),true)}}f.overrideMimeType("text/html");mt(f,o,s,a,r);f.onload=function(){try{if(!$(o,"beforeOnLoad.kutty",{xhr:f,target:s}))return;R(o,this.getResponseHeader("X-KT-Trigger"));var r=this.getResponseHeader("X-KT-Push");var n=st(o)||r;if(this.status>=200&&this.status<400){if(this.status!==204){var i=this.response;if(!$(o,"beforeSwap.kutty",{xhr:f,target:s,response:i}))return;if(n){nt()}var a=bt(o);s.classList.add("kutty-swapping");var t=function(){try{var t=M(a.swapStyle,s,o,i);s.classList.remove("kutty-swapping");s.classList.add("kutty-settling");$(o,"afterSwap.kutty",{xhr:f,target:s});var e=function(){m(t,function(t){t.call()});s.classList.remove("kutty-settling");if(n){it(r||v);nt()}$(o,"afterSettle.kutty",{xhr:f,target:s})};if(a.settleDelay>0){setTimeout(e,a.settleDelay)}else{e()}}catch(t){$(o,"swapError.kutty",{xhr:f,response:f.response,status:f.status,target:s});throw t}};if(a.swapDelay>0){setTimeout(t,y(a.swapDelay))}else{t()}}}else{$(o,"responseError.kutty",{xhr:f,response:f.response,status:f.status,target:s})}}catch(t){$(o,"onLoadError.kutty",{xhr:f,response:f.response,status:f.status,target:s});throw t}finally{ft(o);u();$(o,"afterOnLoad.kutty",{xhr:f,response:f.response,status:f.status,target:s})}};f.onerror=function(){ft(o);$(o,"sendError.kutty",{xhr:f});u()};if(!$(o,"beforeRequest.kutty",{xhr:f,values:c,target:s}))return u();lt(o);f.send(t==="get"?null:ht(c))}function wt(t){if(s().readyState!=="loading"){t()}else{s().addEventListener("DOMContentLoaded",t)}}var Et=s().styleSheets[0];Et.insertRule(".kutty-indicator{opacity:0;transition: opacity 500ms ease-in;}\n"+".kutty-request .kutty-indicator{opacity:1}\n"+".kutty-request.kutty-indicator{opacity:1}\n",Et.cssRules.length);wt(function(){var t=s().body;Y(t);$(t,"load.kutty",{elt:t});window.onpopstate=function(){ut()}});function Ot(t){return eval(t)}function Lt(e){kutty.on("load.kutty",function(t){e(t.detail.elt)})}return{processElement:Y,on:n,onLoad:Lt,version:"0.0.1",_:Ot}}();