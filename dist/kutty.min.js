var kutty=kutty||function(){"use strict";var t=["get","post","put","delete","patch"];function e(){return{getFullPath:function(){return location.pathname+location.search},getLocalStorage:function(){return localStorage},getHistory:function(){return history}}}var n=e();function y(t){if(t==="null"||t==="false"||t===""){return null}else if(t.lastIndexOf("ms")===t.length-2){return parseFloat(t.substr(0,t.length-2))}else if(t.lastIndexOf("s")===t.length-1){return parseFloat(t.substr(0,t.length-1))*1e3}else{return parseFloat(t)}}function h(t,e){return t.getAttribute&&t.getAttribute(e)}function u(t,e){return h(t,e)||h(t,"data-"+e)}function i(t){return t.parentElement}function a(){return document}function o(){return a().body}function s(t,e){if(e(t)){return t}else if(i(t)){return s(i(t),e)}else{return null}}function p(t,e){var r=null;s(t,function(t){return r=h(t,e)});return r}function l(t,e){var r=t.matches||t.matchesSelector||t.msMatchesSelector||t.mozMatchesSelector||t.webkitMatchesSelector||t.oMatchesSelector;return t!=null&&r!=null&&r.call(t,e)}function f(t,e){do{if(t==null||l(t,e))return t}while(t=t&&i(t))}function r(t){var e=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i;var r=e.exec(t);if(r){return r[1].toLowerCase()}else{return""}}function c(t,e){var r=new DOMParser;var n=r.parseFromString(t,"text/html");var i=n.body;while(e>0){e--;i=i.firstChild}return i}function v(t){var e=r(t);switch(e){case"thead":case"tbody":case"tfoot":case"colgroup":case"caption":return c("<table>"+t+"</table>",1);case"col":return c("<table><colgroup>"+t+"</colgroup></table>",2);case"tr":return c("<table><tbody>"+t+"</tbody></table>",2);case"td":case"th":return c("<table><tbody><tr>"+t+"</tr></tbody></table>",3);default:return c(t,0)}}function d(t,e){return Object.prototype.toString.call(t)==="[object "+e+"]"}function g(t){return d(t,"Function")}function m(t){return d(t,"Object")}function k(t){var e="kutty-internal-data";var r=t[e];if(!r){r=t[e]={}}return r}function b(t,e){if(t){for(var r=0;r<t.length;r++){e(t[r])}}}function S(t){var e=t.getBoundingClientRect();var r=e.top;var n=e.bottom;return r<window.innerHeight&&n>=0}function w(t){return o().contains(t)}function E(t,e){return t.concat(e)}function L(t){return t.split(/\s+/)}function O(t){var e=a().styleSheets[0];e.insertRule(t,e.cssRules.length)}function T(t){var e=s(t,function(t){return h(t,"kt-target")!==null});if(e){var r=h(e,"kt-target");if(r==="this"){return e}else{return a().querySelector(r)}}else{var n=k(t);if(n.boosted){return o()}else{return t}}}function C(e,r){b(e.attributes,function(t){if(!r.hasAttribute(t.name)){e.removeAttribute(t.name)}});b(r.attributes,function(t){e.setAttribute(t.name,t.value)})}function x(t){var n=[];b(t.children,function(t){if(u(t,"kt-swap-oob")==="true"){var e=a().getElementById(t.id);if(e){var r=a().createDocumentFragment();r.appendChild(t);n=n.concat(A(e,r))}else{t.parentNode.removeChild(t);it(o(),"oobErrorNoTarget.kutty",{content:t})}}});return n}function N(n,t){var i=[];b(t.querySelectorAll("[id]"),function(t){var e=n.querySelector(t.tagName+"[id="+t.id+"]");if(e){var r=t.cloneNode();C(t,e);i.push(function(){C(t,r)})}});return i}function q(t,e,r){var n=N(t,r);while(r.childNodes.length>0){var i=r.firstChild;t.insertBefore(i,e);if(i.nodeType!==Node.TEXT_NODE){it(i,"load.kutty",{});et(i)}}return n}function A(t,e){if(t.tagName==="BODY"){return H(t,e)}else{var r=q(i(t),t,e);i(t).removeChild(t);return r}}function M(t,e){return q(t,t.firstChild,e)}function R(t,e){return q(i(t),t,e)}function D(t,e){return q(t,null,e)}function F(t,e){return q(i(t),t.nextSibling,e)}function H(t,e){var r=t.firstChild;var n=q(t,r,e);if(r){while(r.nextSibling){t.removeChild(r.nextSibling)}t.removeChild(r)}return n}function I(t,e){var r=p(t,"kt-select");if(r){var n=a().createDocumentFragment();b(e.querySelectorAll(r),function(t){n.appendChild(t)});e=n}return e}function P(t,e,r,n){var i=v(n);if(i){var a=x(i);i=I(r,i);switch(t){case"outerHTML":return E(a,A(e,i));case"afterbegin":return E(a,M(e,i));case"beforebegin":return E(a,R(e,i));case"beforeend":return E(a,D(e,i));case"afterend":return E(a,F(e,i));default:return E(a,H(e,i))}}}function X(t,e){if(e){if(e.indexOf("{")===0){var r=JSON.parse(e);for(var n in r){if(r.hasOwnProperty(n)){var i=r[n];if(!m(i)){i={value:i}}it(t,n,i)}}}else{it(t,e,[])}}}function U(t){var e={trigger:"click"};var r=u(t,"kt-trigger");if(r){var n=L(r);if(n.length>0){var i=n[0];if(i==="every"){e.pollInterval=y(n[1])}else if(i.indexOf("sse:")===0){e.sseEvent=i.substr(4)}else{e["trigger"]=i;for(var a=1;a<n.length;a++){var o=n[a].trim();if(o==="changed"){e.changed=true}if(o==="once"){e.once=true}if(o.indexOf("delay:")===0){e.delay=y(o.substr(6))}}}}}else{if(l(t,"form")){e["trigger"]="submit"}else if(l(t,"input, textarea, select")){e["trigger"]="change"}}return e}function j(t){var e=L(t);if(e.length>1){var r=e[0];var n=e[1].trim();var i;var a;if(n.indexOf(":")>0){var o=n.split(":");i=o[0];a=y(o[1])}else{i=n;a=100}return{operation:r,cssClass:i,delay:a}}else{return null}}function B(i,t,e){b(t.split("&"),function(t){var n=0;b(t.split(","),function(t){var e=t.trim();var r=j(e);if(r){if(r.operation==="toggle"){setTimeout(function(){setInterval(function(){i.classList[r.operation].call(i.classList,r.cssClass)},r.delay)},n);n=n+r.delay}else{n=n+r.delay;setTimeout(function(){i.classList[r.operation].call(i.classList,r.cssClass)},n)}}})})}function J(t,e,r,n){var i=k(t);i.timeout=setTimeout(function(){if(w(t)){xt(t,e,r);J(t,e,u(t,"kt-"+e),n)}},n)}function K(t){return location.hostname===t.hostname&&h(t,"href")&&!h(t,"href").startsWith("#")}function V(t,e,r){if(t.tagName==="A"&&K(t)||t.tagName==="FORM"){e.boosted=true;var n,i;if(t.tagName==="A"){n="get";i=h(t,"href")}else{var a=h(t,"method");n=a?a.toLowerCase():"get";i=h(t,"action")}G(t,n,i,e,r,true)}}function z(t){return t.tagName==="FORM"||l(t,'input[type="submit"], button')&&f(t,"form")!==null||t.tagName==="A"&&t.href&&t.href.indexOf("#")!==0}function G(i,a,o,t,u,s){var e=function(t){if(s||z(i))t.preventDefault();var e=k(t);var r=k(i);if(!e.handled){e.handled=true;if(u.once){if(r.triggeredOnce){return}else{r.triggeredOnce=true}}if(u.changed){if(r.lastValue===i.value){return}else{r.lastValue=i.value}}if(r.delayed){clearTimeout(r.delayed)}var n=function(){xt(i,a,o,t.target)};if(u.delay){r.delayed=setTimeout(n,u.delay)}else{n()}}};t.trigger=u.trigger;t.eventListener=e;i.addEventListener(u.trigger,e)}function _(){if(!window["kuttyScrollHandler"]){var t=function(){b(a().querySelectorAll("[kt-trigger='revealed']"),function(t){W(t)})};window["kuttyScrollHandler"]=t;window.addEventListener("scroll",t)}}function W(t){var e=k(t);if(!e.revealed&&S(t)){e.revealed=true;xt(t,e.verb,e.path)}}function Y(t){if(!w(t)){t.sseSource.close();return true}}function Q(e,t){var r={config:{withCredentials:true}};it(e,"initSSE.kutty",r);var n=new EventSource(t,r.config);n.onerror=function(t){it(e,"sseError.kutty",{error:t,source:n});Y(e)};k(e).sseSource=n}function Z(t,e,r,n){var i=s(t,function(t){return t.sseSource});if(i){var a=function(){if(!Y(i)){if(w(t)){xt(t,e,r)}else{i.sseSource.removeEventListener(n,a)}}};i.sseSource.addEventListener(n,a)}else{it(t,"noSSESourceError.kutty")}}function $(t,e,r,n,i){var a=function(){if(!n.loaded){n.loaded=true;xt(t,e,r)}};if(i){setTimeout(a,i)}else{a()}}function tt(r,n,i){var a=false;b(t,function(t){var e=u(r,"kt-"+t);if(e){a=true;n.path=e;n.verb=t;if(i.sseEvent){Z(r,t,e,i.sseEvent)}else if(i.trigger==="revealed"){_();W(r)}else if(i.trigger==="load"){$(r,t,e,n,i.delay)}else if(i.pollInterval){n.polling=true;J(r,t,e,i.pollInterval)}else{G(r,t,e,n,i)}}});return a}function et(t){var e=k(t);if(!e.processed){e.processed=true;var r=U(t);var n=tt(t,e,r);if(!n&&p(t,"kt-boost")==="true"){V(t,e,r)}var i=u(t,"kt-sse-source");if(i){Q(t,i)}var a=u(t,"kt-classes");if(a){B(t,a)}}if(t.children){b(t.children,function(t){et(t)})}}function rt(t,e,r){var n=p(t,"kt-error-url");if(n){var i=new XMLHttpRequest;i.open("POST",n);i.setRequestHeader("Content-Type","application/json;charset=UTF-8");i.send(JSON.stringify({elt:t.id,event:e,detail:r}))}}function nt(t,e){var r;if(window.CustomEvent&&typeof window.CustomEvent==="function"){r=new CustomEvent(t,{bubbles:true,cancelable:true,detail:e})}else{r=a().createEvent("CustomEvent");r.initCustomEvent(t,true,true,e)}return r}function it(t,e,r){r["elt"]=t;var n=nt(e,r);if(kutty.logger){kutty.logger(t,e,r);if(e.indexOf("Error")>0){rt(t,e,r)}}var i=t.dispatchEvent(n);var a=t.dispatchEvent(nt("all.kutty",{originalDetail:r,originalEvent:n}));return i&&a}function at(t,e,r){var n,i,a;if(g(t)){Nt(function(){n=o();i="all.kutty";a=t;n.addEventListener(i,a)})}else if(g(e)){Nt(function(){n=o();i=t;a=e;n.addEventListener(i,a)})}else{n=t;i=e;a=r;n.addEventListener(i,a)}}function ot(){var t=a().querySelector("[kt-history-elt]");return t||o()}function ut(t,r){t=t.sort(function(t,e){return r[e]-r[t]});var e=0;b(t,function(t){e++;if(e>20){delete r[t];n.getLocalStorage().removeItem(t)}})}function st(t){var e=JSON.parse(n.getLocalStorage().getItem("kt-history-timestamps"))||{};e[t]=Date.now();var r=Object.keys(e);if(r.length>20){ut(r,e)}n.getLocalStorage().setItem("kt-history-timestamps",JSON.stringify(e))}function lt(){var t=ot();var e=n.getFullPath();it(o(),"historyUpdate.kutty",{path:e,historyElt:t});n.getHistory().replaceState({},a().title);n.getLocalStorage().setItem("kt-history:"+e,t.innerHTML);st(e)}function ft(t){n.getHistory().pushState({},"",t)}function ct(t){b(t,function(t){t.call()})}function vt(t){var e=new XMLHttpRequest;var r={path:t,xhr:e};it(o(),"historyCacheMiss.kutty",r);e.open("GET",t,true);e.onload=function(){if(this.status>=200&&this.status<400){it(o(),"historyCacheMissLoad.kutty",r);var t=v(this.response);t=t.querySelector("[kt-history-elt]")||t;ct(H(ot(),t))}else{it(o(),"historyCacheMissLoadError.kutty",r)}};e.send()}function dt(){var t=n.getFullPath();it(o(),"historyRestore.kutty",{path:t});var e=n.getLocalStorage().getItem("kt-history:"+t);if(e){st(t);ct(H(ot(),v(e)))}else{vt(t)}}function gt(t){return p(t,"kt-push-url")==="true"||t.tagName==="A"&&k(t).boosted}function yt(t){pt(t,"add")}function ht(t){pt(t,"remove")}function pt(t,e){var r=p(t,"kt-indicator");if(r){var n=a().querySelectorAll(r)}else{n=[t]}b(n,function(t){t.classList[e].call(t.classList,"kutty-request")})}function mt(t,e){for(var r=0;r<t.length;r++){var n=t[r];if(n.isSameNode(e)){return true}}return false}function kt(t){if(t.name===""||t.name==null||t.disabled){return false}if(t.type==="button"||t.type==="submit"||t.tagName==="image"||t.tagName==="reset"||t.tagName==="file"){return false}if(t.type==="checkbox"||t.type==="radio"){return t.checked}return true}function bt(e,r,t){if(t==null||mt(e,t)){return}else{e.push(t)}if(kt(t)){var n=h(t,"name");var i=t.value;if(n&&i){var a=r[n];if(a){if(Array.isArray(a)){a.push(i)}else{r[n]=[a,i]}}else{r[n]=i}}}if(l(t,"form")){var o=t.elements;b(o,function(t){bt(e,r,t)})}}function St(t){var e=[];var r={};bt(e,r,t);var n=p(t,"kt-include");if(n){var i=a().querySelectorAll(n);b(i,function(t){bt(e,r,t)})}bt(e,r,f(t,"form"));return r}function wt(t,e,r){if(t!==""){t+="&"}t+=encodeURIComponent(e)+"="+encodeURIComponent(r);return t}function Et(t){var e="";for(var r in t){if(t.hasOwnProperty(r)){var n=t[r];if(Array.isArray(n)){b(n,function(t){e=wt(e,r,t)})}else{e=wt(e,r,n)}}}return e}function Lt(t,e,r,n){t.setRequestHeader((n?"":"X-KT-")+e,r||"")}function Ot(t,e,r,n,i){Lt(t,"Request","true");Lt(t,"Trigger",h(e,"id"));Lt(t,"Trigger-Name",h(e,"name"));Lt(t,"Target",h(r,"id"));Lt(t,"Current-URL",a().location.href);if(n){Lt(t,"Prompt",n)}if(i){Lt(t,"Event-Target",h(i,"id"))}if(a().activeElement){Lt(t,"Active-Element",h(a().activeElement,"id"));Lt(t,"Active-Element-Name",h(a().activeElement,"name"));if(a().activeElement.value){Lt(t,"Active-Element-Value",a().activeElement.value)}}}function Tt(e,t,r){var n=p(t,"kt-params");if(n){if(n==="none"){return{}}else if(n==="*"){return e}else if(n.indexOf("not ")===0){b(n.substr(4).split(","),function(t){t=t.trim();delete e[t]});return e}else{var i={};b(n.split(","),function(t){t=t.trim();i[t]=e[t]});return i}}else{if(r==="get"){return{}}else{return e}}}function Ct(t){var e=p(t,"kt-swap");var r={swapStyle:"innerHTML",swapDelay:0,settleDelay:100};if(e){var n=L(e);if(n.length>0){r["swapStyle"]=n[0];for(var i=1;i<n.length;i++){var a=n[i];if(a.indexOf("swap:")===0){r["swapDelay"]=y(a.substr(5))}if(a.indexOf("settle:")===0){r["settleDelay"]=y(a.substr(7))}}}}return r}function xt(o,t,e,r){var u=T(o);if(u==null){it(o,"targetError.kutty",{target:h(o,"kt-target")});return}var n=k(o);if(n.requestInFlight){return}else{n.requestInFlight=true}var s=function(){n.requestInFlight=false};var i=p(o,"kt-prompt");if(i){var a=a(i);if(!it(o,"prompt.kutty",{prompt:a,target:u}))return s()}var l=p(o,"kt-confirm");if(l){if(!confirm(l))return s()}var f=new XMLHttpRequest;var c=St(o,t);c=Tt(c,o,t);if(!it(o,"parameters.kutty",{parameters:c,target:u}))return s();var v;if(t==="get"){var d=Object.keys(c).length===0;v=e+(d?"":"?"+Et(c));f.open("GET",v,true)}else{v=e;f.open("POST",v,true);Lt(f,"Content-Type","application/x-www-form-urlencoded; charset=UTF-8",true);if(t!=="post"){Lt(f,"X-HTTP-Method-Override",t.toUpperCase(),true)}}f.overrideMimeType("text/html");Ot(f,o,u,a,r);var g={xhr:f,target:u};f.onload=function(){try{if(!it(o,"beforeOnLoad.kutty",g))return;X(o,this.getResponseHeader("X-KT-Trigger"));var r=this.getResponseHeader("X-KT-Push");var n=gt(o)||r;if(this.status>=200&&this.status<400){if(this.status!==204){if(!it(o,"beforeSwap.kutty",g))return;var i=this.response;if(n){lt()}var a=Ct(o);u.classList.add("kutty-swapping");var t=function(){try{var t=P(a.swapStyle,u,o,i);u.classList.remove("kutty-swapping");u.classList.add("kutty-settling");it(o,"afterSwap.kutty",g);var e=function(){b(t,function(t){t.call()});u.classList.remove("kutty-settling");if(n){ft(r||v);lt()}it(o,"afterSettle.kutty",g)};if(a.settleDelay>0){setTimeout(e,a.settleDelay)}else{e()}}catch(t){it(o,"swapError.kutty",g);throw t}};if(a.swapDelay>0){setTimeout(t,y(a.swapDelay))}else{t()}}}else{it(o,"responseError.kutty",g)}}catch(t){g["exception"]=t;it(o,"onLoadError.kutty",g);throw t}finally{ht(o);s();it(o,"afterOnLoad.kutty",g)}};f.onerror=function(){ht(o);it(o,"sendError.kutty",g);s()};if(!it(o,"beforeRequest.kutty",g))return s();yt(o);f.send(t==="get"?null:Et(c))}function Nt(t){if(a().readyState!=="loading"){t()}else{a().addEventListener("DOMContentLoaded",t)}}O(".kutty-indicator{opacity:0;transition: opacity 200ms ease-in;}");O(".kutty-request .kutty-indicator{opacity:1}");O(".kutty-request.kutty-indicator{opacity:1}");Nt(function(){var t=o();et(t);it(t,"load.kutty",{});window.onpopstate=function(){dt()}});function qt(t){return eval(t)}function At(e){kutty.on("load.kutty",function(t){e(t.detail.elt)})}function Mt(){kutty.logger=function(t,e,r){if(console){console.log(e,t,r)}}}function Rt(t){n=t}function Dt(){n=n()}return{processElement:et,on:at,onLoad:At,logAll:Mt,version:"0.0.1",_:qt}}();